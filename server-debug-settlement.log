
> rest-express@1.0.0 dev
> NODE_ENV=development tsx server/index.ts

🚀 Pre-loading UST curve data on startup...
Fetching UST yield curve from FRED API...
4:50:24 PM [express] serving on port 3000
[36m[INFO][0m System performance metrics {
  "memoryUsage": {
    "rss": 407,
    "heapUsed": 78,
    "heapTotal": 109,
    "external": 5
  },
  "uptime": 1
}
✓ UST curve fetched from FRED: 2025-06-12 (11 tenors)
✅ UST curve data pre-loaded successfully
   Date: 2025-06-12
   Tenors: 11 points
   1M: 4.180% | 10Y: 4.360% | 30Y: 4.840%
Browserslist: browsers data (caniuse-lite) is 8 months old. Please run:
  npx update-browserslist-db@latest
  Why you should do it regularly: https://github.com/browserslist/update-db#readme
4:50:25 PM [express] GET /api/bonds/saved 304 in 5ms :: {"bonds":[{"filename":"GD29_ARGENTINA_100pct…
4:50:25 PM [express] GET /api/bonds/saved/GD30_ARGENTINA_075pct_20300709.json 304 in 2ms :: {"metada…
🔍 buildBond received bond with predefinedCashFlows: 19
🔍 Bond issuer: REPUBLIC OF ARGENTINA, features: { isAmortizing: true, isVariableCoupon: true }
🔍 Validating amortization schedule with 13 entries
🔍 Adding 4%, running total: 4%
🔍 Adding 8%, running total: 12%
🔍 Adding 8%, running total: 20%
🔍 Adding 8%, running total: 28%
🔍 Adding 8%, running total: 36%
🔍 Adding 8%, running total: 44%
🔍 Adding 8%, running total: 52%
🔍 Adding 8%, running total: 60%
🔍 Adding 8%, running total: 68%
🔍 Adding 8%, running total: 76%
🔍 Adding 8%, running total: 84%
🔍 Adding 8%, running total: 92%
🔍 Adding 8%, running total: 100%
🔍 Final amortization total: 100% (VALID)
🔄 Using predefined cash flows: 19 flows
🔢 Market inputs provided, calculating full analytics
🚀 Using production bond calculator engine
🔍 OUTSTANDING PRINCIPAL CALCULATION: {
  originalFaceValue: 1000,
  currentOutstanding: 880,
  settlementDate: '2025-06-14',
  outstandingRatio: 0.88
}
💰 Cash flow filtering: Total 19 → Future 11 (settlement: 2025-06-14)
📥 Backend received: {
  marketPrice: 100,
  targetYield: undefined,
  targetSpread: undefined,
  issuer: 'REPUBLIC OF ARGENTINA',
  maturityDate: '2030-07-09'
}
🔍 Calculation inputs - Price: 100, Yield: undefined, Spread: undefined
🎯 Price → YTM mode. Market Price: 100
🔍 Price input: 100 (100.00% of face value)
🔍 CALLING CALCULATOR ANALYZE with: {
  bondCashFlowCount: 11,
  price: 100,
  settlementDate: '2025-06-14',
  hasTreasuryCurve: true
}
🔍 OUTSTANDING PRINCIPAL DEBUG: {
  faceValue: 880,
  currentOutstanding: 880,
  settlementDate: '2025-06-14',
  outstandingRatio: 1
}
🎯 YTM Solver Starting:
  - Target Price: 880
  - Cash Flows: 11
  - Total CF Amount: 911
  🔧 Trying Newton-Raphson algorithm...
💡 Initial YTM Guess:
  - Total CFs: 911
  - Target Price: 880
  - Total Return: 1.0352
  - Average Time: 2.56 years
  - Raw Annualized: 1.36%
  - Clamped Guess: 1.36%
    Iteration 0: yield = 1.372%, error = 0.200050
  ✅ Newton-Raphson converged: YTM = 1.372%
🔄 Z-Spread Calculation:
  - Target Price: 880
  - Cash Flows: 11
  - Z-Spread final: -100 bps
🔍 RAW CALCULATOR RESULT: {
  yields: {
    ytm: 1.3718341152295963,
    ytw: 1.3718341152295963,
    current: 0.7159090909090909
  },
  risk: {
    modifiedDuration: 2.4899115721524225,
    macaulayDuration: 2.5240690285382588,
    effectiveDuration: 2.489911678700257,
    convexity: 11.06988624637674,
    dv01: 0.21911221834941316
  },
  price: {
    clean: 100,
    dirty: 100,
    cleanDollar: 880,
    dirtyDollar: 880,
    accruedInterest: 0
  },
  analytics: {
    averageLife: 2.569846307012632,
    totalCashFlows: 911,
    daysToNextPayment: 25,
    nextPaymentDate: '2025-07-09',
    nextPaymentAmount: 83.3
  },
  spreads: { treasury: -346.81658847704034, zSpread: -99.99999999999974 }
}
🔍 PRICE FIELD DETAILED: {
  clean: 100,
  dirty: 100,
  cleanDollar: 880,
  dirtyDollar: 880,
  accruedInterest: 0
}
✅ FINAL ANALYTICS: {
  ytm: 1.3718341152295963,
  duration: 2.4899115721524225,
  cleanPrice: 100,
  spread: -346.81658847704034
}
4:50:25 PM [express] POST /api/bonds/build 200 in 23ms :: {"bond":{"issuer":"REPUBLIC OF ARGENTINA",…
4:50:25 PM [express] GET /api/bonds/saved 304 in 4ms :: {"bonds":[{"filename":"GD29_ARGENTINA_100pct…
📊 Calculate request received with predefinedCashFlows? true
📊 Number of predefined cash flows: 19
📊 Parsed bond data has predefinedCashFlows? true
🔍 buildBond received bond with predefinedCashFlows: 19
🔍 Bond issuer: REPUBLIC OF ARGENTINA, features: { isAmortizing: true, isVariableCoupon: true }
🔍 Validating amortization schedule with 13 entries
🔍 Adding 4%, running total: 4%
🔍 Adding 8%, running total: 12%
🔍 Adding 8%, running total: 20%
🔍 Adding 8%, running total: 28%
🔍 Adding 8%, running total: 36%
🔍 Adding 8%, running total: 44%
🔍 Adding 8%, running total: 52%
🔍 Adding 8%, running total: 60%
🔍 Adding 8%, running total: 68%
🔍 Adding 8%, running total: 76%
🔍 Adding 8%, running total: 84%
🔍 Adding 8%, running total: 92%
🔍 Adding 8%, running total: 100%
🔍 Final amortization total: 100% (VALID)
🔄 Using predefined cash flows: 19 flows
🔢 Market inputs provided, calculating full analytics
🚀 Using production bond calculator engine
🔍 OUTSTANDING PRINCIPAL CALCULATION: {
  originalFaceValue: 1000,
  currentOutstanding: 880,
  settlementDate: '2025-06-14',
  outstandingRatio: 0.88
}
💰 Cash flow filtering: Total 19 → Future 11 (settlement: 2025-06-14)
📥 Backend received: {
  marketPrice: 100,
  targetYield: undefined,
  targetSpread: undefined,
  issuer: 'REPUBLIC OF ARGENTINA',
  maturityDate: '2030-07-09'
}
🔍 Calculation inputs - Price: 100, Yield: undefined, Spread: undefined
🎯 Price → YTM mode. Market Price: 100
🔍 Price input: 100 (100.00% of face value)
🔍 CALLING CALCULATOR ANALYZE with: {
  bondCashFlowCount: 11,
  price: 100,
  settlementDate: '2025-06-14',
  hasTreasuryCurve: true
}
🔍 OUTSTANDING PRINCIPAL DEBUG: {
  faceValue: 880,
  currentOutstanding: 880,
  settlementDate: '2025-06-14',
  outstandingRatio: 1
}
🎯 YTM Solver Starting:
  - Target Price: 880
  - Cash Flows: 11
  - Total CF Amount: 911
  🔧 Trying Newton-Raphson algorithm...
💡 Initial YTM Guess:
  - Total CFs: 911
  - Target Price: 880
  - Total Return: 1.0352
  - Average Time: 2.56 years
  - Raw Annualized: 1.36%
  - Clamped Guess: 1.36%
    Iteration 0: yield = 1.372%, error = 0.200050
  ✅ Newton-Raphson converged: YTM = 1.372%
🔄 Z-Spread Calculation:
  - Target Price: 880
  - Cash Flows: 11
  - Z-Spread final: -100 bps
🔍 RAW CALCULATOR RESULT: {
  yields: {
    ytm: 1.3718341152295963,
    ytw: 1.3718341152295963,
    current: 0.7159090909090909
  },
  risk: {
    modifiedDuration: 2.4899115721524225,
    macaulayDuration: 2.5240690285382588,
    effectiveDuration: 2.489911678700257,
    convexity: 11.06988624637674,
    dv01: 0.21911221834941316
  },
  price: {
    clean: 100,
    dirty: 100,
    cleanDollar: 880,
    dirtyDollar: 880,
    accruedInterest: 0
  },
  analytics: {
    averageLife: 2.569846307012632,
    totalCashFlows: 911,
    daysToNextPayment: 25,
    nextPaymentDate: '2025-07-09',
    nextPaymentAmount: 83.3
  },
  spreads: { treasury: -346.81658847704034, zSpread: -99.99999999999974 }
}
🔍 PRICE FIELD DETAILED: {
  clean: 100,
  dirty: 100,
  cleanDollar: 880,
  dirtyDollar: 880,
  accruedInterest: 0
}
✅ FINAL ANALYTICS: {
  ytm: 1.3718341152295963,
  duration: 2.4899115721524225,
  cleanPrice: 100,
  spread: -346.81658847704034
}
4:50:26 PM [express] POST /api/bonds/calculate 200 in 18ms :: {"analytics":{"yieldToMaturity":1.3718…
4:50:31 PM [express] GET /api/bonds/saved 200 in 1ms :: {"bonds":[{"filename":"GD29_ARGENTINA_100pct…
📊 Calculate request received with predefinedCashFlows? true
📊 Number of predefined cash flows: 19
📊 Parsed bond data has predefinedCashFlows? true
🔍 buildBond received bond with predefinedCashFlows: 19
🔍 Bond issuer: REPUBLIC OF ARGENTINA, features: { isAmortizing: true, isVariableCoupon: true }
🔍 Validating amortization schedule with 13 entries
🔍 Adding 4%, running total: 4%
🔍 Adding 8%, running total: 12%
🔍 Adding 8%, running total: 20%
🔍 Adding 8%, running total: 28%
🔍 Adding 8%, running total: 36%
🔍 Adding 8%, running total: 44%
🔍 Adding 8%, running total: 52%
🔍 Adding 8%, running total: 60%
🔍 Adding 8%, running total: 68%
🔍 Adding 8%, running total: 76%
🔍 Adding 8%, running total: 84%
🔍 Adding 8%, running total: 92%
🔍 Adding 8%, running total: 100%
🔍 Final amortization total: 100% (VALID)
🔄 Using predefined cash flows: 19 flows
🔢 Market inputs provided, calculating full analytics
🚀 Using production bond calculator engine
🔍 OUTSTANDING PRINCIPAL CALCULATION: {
  originalFaceValue: 1000,
  currentOutstanding: 880,
  settlementDate: '2025-06-14',
  outstandingRatio: 0.88
}
💰 Cash flow filtering: Total 19 → Future 11 (settlement: 2025-06-14)
📥 Backend received: {
  marketPrice: 80,
  targetYield: undefined,
  targetSpread: undefined,
  issuer: 'REPUBLIC OF ARGENTINA',
  maturityDate: '2030-07-09'
}
🔍 Calculation inputs - Price: 80, Yield: undefined, Spread: undefined
🎯 Price → YTM mode. Market Price: 80
🔍 Price input: 80 (80.00% of face value)
🔍 CALLING CALCULATOR ANALYZE with: {
  bondCashFlowCount: 11,
  price: 80,
  settlementDate: '2025-06-14',
  hasTreasuryCurve: true
}
🔍 OUTSTANDING PRINCIPAL DEBUG: {
  faceValue: 880,
  currentOutstanding: 880,
  settlementDate: '2025-06-14',
  outstandingRatio: 1
}
🎯 YTM Solver Starting:
  - Target Price: 704
  - Cash Flows: 11
  - Total CF Amount: 911
  🔧 Trying Newton-Raphson algorithm...
💡 Initial YTM Guess:
  - Total CFs: 911
  - Target Price: 704
  - Total Return: 1.2940
  - Average Time: 2.56 years
  - Raw Annualized: 10.60%
  - Clamped Guess: 10.60%
    Iteration 0: yield = 11.143%, error = 8.901503
    Iteration 5: yield = 11.208%, error = 0.000097
    Iteration 10: yield = 11.208%, error = 0.000000
    ⚠️ Yield oscillating, stopping at 11.208%
  ❌ Newton-Raphson failed to converge
  🔧 Trying Brent algorithm...
  ✅ Brent converged: YTM = -19.393%
🔄 Z-Spread Calculation:
  - Target Price: 704
  - Cash Flows: 11
  - Z-Spread final: 500 bps
❌ Negative YTM calculated: -19.39%
❌ Calculator failed: Error: Calculation error: Negative YTM of -19.39% suggests invalid inputs.
    at MemStorage.calculateWithProductionEngine (/Users/juanotero/Documents/GitHub/bond_calculator/server/storage.ts:690:15)
    at MemStorage.calculateBondAnalytics (/Users/juanotero/Documents/GitHub/bond_calculator/server/storage.ts:465:17)
    at MemStorage.buildBond (/Users/juanotero/Documents/GitHub/bond_calculator/server/storage.ts:224:32)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async <anonymous> (/Users/juanotero/Documents/GitHub/bond_calculator/server/routes.ts:205:22)
❌ Bond that failed: REPUBLIC OF ARGENTINA 0.125 2030-07-09
❌ Inputs were - Price: 80 Yield: undefined Spread: undefined
Bond build error: Error: Calculation error: Negative YTM of -19.39% suggests invalid inputs.
    at MemStorage.calculateWithProductionEngine (/Users/juanotero/Documents/GitHub/bond_calculator/server/storage.ts:690:15)
    at MemStorage.calculateBondAnalytics (/Users/juanotero/Documents/GitHub/bond_calculator/server/storage.ts:465:17)
    at MemStorage.buildBond (/Users/juanotero/Documents/GitHub/bond_calculator/server/storage.ts:224:32)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async <anonymous> (/Users/juanotero/Documents/GitHub/bond_calculator/server/routes.ts:205:22)
4:50:31 PM [express] POST /api/bonds/calculate 200 in 95ms :: {"analytics":{"yieldToMaturity":0,"yie…
📊 Calculate request received with predefinedCashFlows? true
📊 Number of predefined cash flows: 19
📊 Parsed bond data has predefinedCashFlows? true
🔍 buildBond received bond with predefinedCashFlows: 19
🔍 Bond issuer: REPUBLIC OF ARGENTINA, features: { isAmortizing: true, isVariableCoupon: true }
🔍 Validating amortization schedule with 13 entries
🔍 Adding 4%, running total: 4%
🔍 Adding 8%, running total: 12%
🔍 Adding 8%, running total: 20%
🔍 Adding 8%, running total: 28%
🔍 Adding 8%, running total: 36%
🔍 Adding 8%, running total: 44%
🔍 Adding 8%, running total: 52%
🔍 Adding 8%, running total: 60%
🔍 Adding 8%, running total: 68%
🔍 Adding 8%, running total: 76%
🔍 Adding 8%, running total: 84%
🔍 Adding 8%, running total: 92%
🔍 Adding 8%, running total: 100%
🔍 Final amortization total: 100% (VALID)
🔄 Using predefined cash flows: 19 flows
🔢 Market inputs provided, calculating full analytics
🚀 Using production bond calculator engine
🔍 OUTSTANDING PRINCIPAL CALCULATION: {
  originalFaceValue: 1000,
  currentOutstanding: 960,
  settlementDate: '2025-01-01',
  outstandingRatio: 0.96
}
💰 Cash flow filtering: Total 19 → Future 12 (settlement: 2025-01-01)
📥 Backend received: {
  marketPrice: 80,
  targetYield: undefined,
  targetSpread: undefined,
  issuer: 'REPUBLIC OF ARGENTINA',
  maturityDate: '2030-07-09'
}
🔍 Calculation inputs - Price: 80, Yield: undefined, Spread: undefined
🎯 Price → YTM mode. Market Price: 80
🔍 Price input: 80 (80.00% of face value)
🔍 CALLING CALCULATOR ANALYZE with: {
  bondCashFlowCount: 12,
  price: 80,
  settlementDate: '2025-01-01',
  hasTreasuryCurve: true
}
🔍 OUTSTANDING PRINCIPAL DEBUG: {
  faceValue: 960,
  currentOutstanding: 960,
  settlementDate: '2025-01-01',
  outstandingRatio: 1
}
🎯 YTM Solver Starting:
  - Target Price: 768
  - Cash Flows: 12
  - Total CF Amount: 994.6
  🔧 Trying Newton-Raphson algorithm...
💡 Initial YTM Guess:
  - Total CFs: 994.6
  - Target Price: 768
  - Total Return: 1.2951
  - Average Time: 2.76 years
  - Raw Annualized: 9.84%
  - Clamped Guess: 9.84%
    Iteration 0: yield = 10.356%, error = 10.036311
    Iteration 5: yield = 10.414%, error = 0.000079
    Iteration 10: yield = 10.414%, error = 0.000000
  ✅ Newton-Raphson converged: YTM = 10.414%
🔄 Z-Spread Calculation:
  - Target Price: 768
  - Cash Flows: 12
  - Z-Spread final: 500 bps
🔍 RAW CALCULATOR RESULT: {
  yields: {
    ytm: 10.413898798915234,
    ytw: 10.413898798915234,
    current: 0.8984375000000001
  },
  risk: {
    modifiedDuration: 2.2322312309423435,
    macaulayDuration: 2.464693532290459,
    effectiveDuration: 2.232231316831982,
    convexity: 9.387242614765814,
    dv01: 0.171435358536372
  },
  price: {
    clean: 80,
    dirty: 80,
    cleanDollar: 768,
    dirtyDollar: 768,
    accruedInterest: 0
  },
  analytics: {
    averageLife: 2.7691079169518598,
    totalCashFlows: 994.6,
    daysToNextPayment: 8,
    nextPaymentDate: '2025-01-09',
    nextPaymentAmount: 83.6
  },
  spreads: { treasury: 557.3898798915234, zSpread: 499.9999999999998 }
}
🔍 PRICE FIELD DETAILED: {
  clean: 80,
  dirty: 80,
  cleanDollar: 768,
  dirtyDollar: 768,
  accruedInterest: 0
}
✅ FINAL ANALYTICS: {
  ytm: 10.413898798915234,
  duration: 2.2322312309423435,
  cleanPrice: 80,
  spread: 557.3898798915234
}
4:50:31 PM [express] POST /api/bonds/calculate 200 in 20ms :: {"analytics":{"yieldToMaturity":10.413…
